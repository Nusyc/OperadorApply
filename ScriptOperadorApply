
CREATE FUNCTION FN_EXEMPLO
(	
	@VALOR DECIMAL(32,2)
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT @VALOR/2 AS VALOR_DIVIDO
)
GO

CREATE TABLE CLIENTE (ID_CLIENTE INT IDENTITY(1,1) PRIMARY KEY, NOME VARCHAR(100))
CREATE TABLE ORCAMENTO (ID_ORCAMENTO INT IDENTITY(1,1) PRIMARY KEY, ID_CLIENTE INT, VALOR DECIMAL(32,2),VALOR2 DECIMAL(32,2),VALOR3 DECIMAL(32,2),VALOR4 DECIMAL(32,2))

INSERT INTO CLIENTE (NOME)
VALUES ('MARCIO'),('CAIO'),('REGINALDO'),('ABRAAO'),('IGOR')

INSERT INTO ORCAMENTO (ID_CLIENTE,VALOR)
VALUES (1,300),(1,400),(3,100),(4,200)

INSERT INTO ORCAMENTO (ID_CLIENTE,VALOR)
VALUES (1,1000),(1,700),(3,300), (3,500),(4,700),(4,5000)

UPDATE ORCAMENTO
SET 
	VALOR2 = VALOR/2,
	VALOR3 = VALOR/3,
	VALOR4 = VALOR/4

--- EXEMPLOS.

SELECT
*
FROM
	CLIENTE A 
INNER JOIN ORCAMENTO B ON A.ID_CLIENTE = B.ID_CLIENTE

SELECT
*
FROM
	CLIENTE A 
CROSS APPLY (SELECT *
			 FROM
				ORCAMENTO B
			WHERE
				A.ID_CLIENTE = B.ID_CLIENTE
			) C

----------- 2

SELECT
*
FROM
	CLIENTE A 
CROSS APPLY (SELECT TOP 2
				*
			 FROM
				ORCAMENTO B
			WHERE
				A.ID_CLIENTE = B.ID_CLIENTE

			ORDER BY
				VALOR DESC
			) C

SELECT
*
FROM
	CLIENTE A 
INNER JOIN (SELECT TOP 2
				*
			 FROM
				ORCAMENTO B
			 WHERE
				A.ID_CLIENTE = B.ID_CLIENTE
			ORDER BY
				VALOR DESC
			) B  ON A.ID_CLIENTE = B.ID_CLIENTE

------------------ 3 
SELECT
	A.NOME,
	B.VALOR
FROM
	CLIENTE A 
CROSS JOIN ORCAMENTO B 

SELECT
	A.NOME,
	B.VALOR
FROM
	CLIENTE A 
CROSS APPLY ORCAMENTO B 
-----------------

SELECT
	A.NOME,
	B.VALOR,
	C.VALOR_DIVIDO 
FROM
	CLIENTE A 
INNER JOIN ORCAMENTO B ON A.ID_CLIENTE = B.ID_CLIENTE
CROSS APPLY FN_EXEMPLO(B.VALOR) AS C

----------- 4 
SELECT ID_CLIENTE,VALOR,VALOR2,VALOR3,VALOR4 FROM ORCAMENTO WHERE ID_CLIENTE = 1 
SELECT
A.ID_CLIENTE,
UNPIVOT_TABLE.NOVA_COLUNA_VALORES
FROM
	CLIENTE A 
INNER JOIN ORCAMENTO B ON A.ID_CLIENTE = B.ID_CLIENTE
CROSS APPLY (
				VALUES (B.VALOR),
					   (B.VALOR2),
					   (B.VALOR3),
					   (B.VALOR4)
			) UNPIVOT_TABLE (NOVA_COLUNA_VALORES)
/*
INSERT INTO CLIENTE (NOME)
VALUES ('MARCIO'), -- LINHA 1
	   ('CAIO'), -- LINHA 2
	   ('REGINALDO'), -- LINHA 3
	   ('ABRAAO'), -- LINHA 4
	   ('IGOR') -- LINHA 5
*/
----------

SELECT
*
FROM
	CLIENTE A 
LEFT JOIN ORCAMENTO B ON A.ID_CLIENTE = B.ID_CLIENTE

SELECT
*
FROM
	CLIENTE A 
OUTER APPLY (SELECT *
			 FROM
				ORCAMENTO B
			WHERE
				A.ID_CLIENTE = B.ID_CLIENTE
			) C
------------------------------

SELECT
*
FROM
	CLIENTE A 
CROSS APPLY (SELECT SUM(VALOR) AS VALOR
			 FROM
				ORCAMENTO B
			WHERE
				A.ID_CLIENTE = B.ID_CLIENTE
			) C

SELECT
	*
FROM
	CLIENTE A 
CROSS APPLY (SELECT SUM(VALOR) AS VALOR
			 FROM
				ORCAMENTO B
			WHERE
				A.ID_CLIENTE = B.ID_CLIENTE
			GROUP BY () -- OU GROUP BY B.ID_CLIENTE
			) C
